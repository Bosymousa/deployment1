# -*- coding: utf-8 -*-
"""app

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1IOrVUWQGxMX6lcFM3bM11WgkzwDWwUMX
"""

# Commented out IPython magic to ensure Python compatibility.
# %pip install streamlit
# %pip install pandas
# %pip install seaborn
# %pip install matplotlib
# %pip install sklearn

import streamlit as st
import pandas as pd
import seaborn as sns
import matplotlib.pyplot as plt
import joblib
from sklearn.preprocessing import StandardScaler
from sklearn.decomposition import PCA

# Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
st.title("Wholesale Customers KMeans Clustering App")

# ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ù…Ø¯Ø±Ø¨
try:
    model = joblib.load("KMeans_model.pkl")
    st.success("âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­")
except:
    st.error("âš ï¸ Ù…Ù„Ù KMeans_model.pkl Ù…Ø´ Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ù†ÙØ³ Ø§Ù„Ù…Ø¬Ù„Ø¯ Ù…Ø¹ app.py")

# Ø±ÙØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
uploaded_file = st.file_uploader("ğŸ“‚ Ø§Ø±ÙØ¹ Ù…Ù„Ù CSV (Ù…Ø«Ù„Ø§Ù‹ Wholesale customers data.csv)", type=["csv"])

if uploaded_file is not None:
    # Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    df = pd.read_csv(uploaded_file)
    st.write("### Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ©:")
    st.dataframe(df.head())

    # Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ù„ØªØ¯Ø±ÙŠØ¨
    features = ['Milk','Grocery','Frozen','Delicassen','Detergents_Paper']

    # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
    missing_cols = [col for col in features if col not in df.columns]
    if missing_cols:
        st.error(f"Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ù†Ø§Ù‚ØµØ©: {missing_cols}")
    else:
        X = df[features].values

        # Scaling
        scaler = StandardScaler()
        X_scaled = scaler.fit_transform(X)

        # Ø§Ù„ØªÙ†Ø¨Ø¤ Ø¨Ø§Ù„ÙƒÙ„Ø³ØªØ± Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ù…Ø­ÙÙˆØ¸
        y_kmeans = model.predict(X_scaled)
        df['cluster'] = y_kmeans

        # PCA Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ 2D
        pca = PCA(n_components=2)
        pca_df = pca.fit_transform(X_scaled)
        pca_df = pd.DataFrame(pca_df, columns=['PC1', 'PC2'])
        pca_df['cluster'] = y_kmeans

        st.write("### Visualization (PCA 2D)")
        fig, ax = plt.subplots(figsize=(8,6))
        sns.scatterplot(data=pca_df, x="PC1", y="PC2", hue="cluster", palette="Set2", ax=ax)
        st.pyplot(fig)

        # Ø¹Ø±Ø¶ Ù…ØªÙˆØ³Ø· Ø§Ù„Ù‚ÙŠÙ… Ù„ÙƒÙ„ Cluster
        st.write("### Ù…ØªÙˆØ³Ø· Ø§Ù„Ù‚ÙŠÙ… ÙÙŠ ÙƒÙ„ Cluster")
        st.dataframe(df.groupby('cluster')[features].mean())

